(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{165:function(e,s,t){"use strict";t.r(s);var n=t(24);const a=e=>{document.addEventListener("connection-status",s=>e.fireMessage({type:"connection-status",payload:{event:s.detail}}))},i=e=>document.addEventListener("haptic",s=>e.fireMessage({type:"haptic",payload:{hapticType:s.detail}})),r="externalBus";class o{constructor(){this.commands={},this.cache={},this.msgId=0}attach(){a(this),i(this),window[r]=(e=>this.receiveMessage(e))}sendMessage(e){const s=++this.msgId;return e.id=s,this.fireMessage(e),new Promise((e,t)=>{this.commands[s]={resolve:e,reject:t}})}fireMessage(e){e.id||(e.id=++this.msgId),this._sendExternal(e)}receiveMessage(e){const s=this.commands[e.id];s?"result"===e.type&&(e.success?s.resolve(e.result):s.reject(e.error)):console.warn("Received unknown msg ID",e.id)}_sendExternal(e){window.externalApp?window.externalApp.externalBus(JSON.stringify(e)):window.webkit.messageHandlers.externalBus.postMessage(e)}}t.d(s,"default",function(){return w});const c="externalAuthSetToken",d="externalAuthRevokeToken";if(!window.externalApp&&!window.webkit)throw new Error("External auth requires either externalApp or webkit defined on Window object.");class w extends n.a{constructor(e){super({hassUrl:e,clientId:"",refresh_token:"",access_token:"",expires_in:0,expires:0}),this.external=new o,this.external.attach()}async refreshAccessToken(){const e={callback:c};window.externalApp?window.externalApp.getExternalAuth(JSON.stringify(e)):window.webkit.messageHandlers.getExternalAuth.postMessage(e);const s=await new Promise((e,s)=>{window[c]=((t,n)=>t?e(n):s(n))});this.data.access_token=s.access_token,this.data.expires=1e3*s.expires_in+Date.now()}async revoke(){const e={callback:d};window.externalApp?window.externalApp.revokeExternalAuth(JSON.stringify(e)):window.webkit.messageHandlers.revokeExternalAuth.postMessage(e),await new Promise((e,s)=>{window[d]=((t,n)=>t?e(n):s(n))})}}}}]);