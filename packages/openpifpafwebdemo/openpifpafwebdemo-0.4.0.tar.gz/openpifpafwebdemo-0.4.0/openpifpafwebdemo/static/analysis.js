!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.openpifpafwebdemo=t():e.openpifpafwebdemo=t()}(window,function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(a,i,function(t){return e[t]}.bind(null,i));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),i=n(2),r="";document.location.search&&"?"===document.location.search[0]&&(r=document.location.search.substr(1)),r||"vita-epfl.github.io"!==document.location.hostname||(r="https://vitademo.epfl.ch");var o=document.getElementById("fps"),s=0,c=null,u=new a.Camera(document.getElementById("capture")),h=new i.Visualization(document.getElementById("visualization"));function d(){var e=u.imageData(),t=new XMLHttpRequest;t.open("POST",r+"/process",!0),t.onload=function(){if(null!=c){var t=Date.now()-c;s=.5*s+1e3/t*.5,o.textContent=""+s.toFixed(1)}c=Date.now(),d();var n=JSON.parse(this.responseText);h.draw(e.image,n)},t.onerror=function(){return setTimeout(d,1e3)},t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(e))}t.newImage=d,d()},function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((a=a.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o={audio:!1,video:{width:640,height:480}},s=function(){function e(e){var t=this;this.ui=e,this.video=e.getElementsByTagName("video")[0],this.captureCanvas=e.getElementsByTagName("canvas")[0],this.originalCaptureCanvasSize=[this.captureCanvas.width,this.captureCanvas.height],this.captureContext=this.captureCanvas.getContext("2d"),this.buttonNextCamera=e.getElementsByClassName("nextCamera")[0],this.captureCounter=0,navigator.mediaDevices.enumerateDevices().then(function(e){t.cameraIds=e.filter(function(e){return"videoinput"===e.kind}).map(function(e){return e.deviceId}),t.cameraIds.length>=2&&t.cameraIds.every(function(e){return""===e})&&(t.cameraIds=["user","environment"])}).catch(function(e){console.log(e.name+": "+e.message)}),this.setCamera(),this.buttonNextCamera.onclick=this.nextCamera.bind(this)}return e.prototype.setCamera=function(e){return i(this,void 0,void 0,function(){var t,n;return r(this,function(i){switch(i.label){case 0:return e&&e===this.cameraId?[2]:(t=a({},o,{video:a({},o.video)}),"user"===e||"environment"===e?t.video.facingMode=e:t.video.deviceId=e,[4,navigator.mediaDevices.getUserMedia(t)]);case 1:return n=i.sent(),this.video.srcObject=n,this.cameraId=e,[2]}})})},e.prototype.imageData=function(){var e=this.video.clientWidth>this.video.clientHeight?this.originalCaptureCanvasSize:this.originalCaptureCanvasSize.slice().reverse();return this.captureCanvas.width!==e[0]&&(this.captureCanvas.width=e[0]),this.captureCanvas.height!==e[1]&&(this.captureCanvas.height=e[1]),this.captureCounter+=1,this.captureContext.drawImage(this.video,0,0,this.captureCanvas.width,this.captureCanvas.height),{image_id:this.captureCounter,image:this.captureCanvas.toDataURL()}},e.prototype.nextCamera=function(){var e=void 0;if(this.cameraId&&this.cameraIds.length>1){var t=this.cameraIds.indexOf(this.cameraId)+1;t>=this.cameraIds.length&&(t=0),e=this.cameraIds[t]}else e=this.cameraIds.length>1?this.cameraIds[1]:this.cameraIds[0];this.setCamera(e)},e}();t.Camera=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=[[16,14],[14,12],[17,15],[15,13],[12,13],[6,12],[7,13],[6,7],[6,8],[7,9],[8,10],[9,11],[2,3],[1,2],[1,3],[2,4],[3,5],[4,6],[5,7]],i=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],r=function(){function e(e){this.canvas=e.getElementsByTagName("canvas")[0],this.originalCanvasSize=[this.canvas.width,this.canvas.height],this.context=this.canvas.getContext("2d"),this.lineWidth=10,this.markerSize=4}return e.prototype.draw=function(e,t){var n=this;t.map(function(e){return e.score});if(t&&t.length>0){var a=t[0].width_height[0]>t[0].width_height[1]?this.originalCanvasSize:this.originalCanvasSize.slice().reverse();this.canvas.width!==a[0]&&(this.canvas.width=a[0]),this.canvas.height!==a[1]&&(this.canvas.height=a[1])}var i=new Image;i.onload=function(){n.context.drawImage(i,0,0,n.canvas.width,n.canvas.height),t.forEach(function(e){return n.drawSkeleton(e.coordinates,e.detection_id)})},i.src=e},e.prototype.drawSkeletonLines=function(e){var t=this;a.forEach(function(n,a){var r=n[0],o=n[1],s=e[r-1],c=e[o-1],u=i[a%i.length];t.context.strokeStyle=u,t.context.lineWidth=t.lineWidth,0!==s[2]&&0!==c[2]&&(t.context.beginPath(),t.context.moveTo(s[0]*t.canvas.width,s[1]*t.canvas.height),t.context.lineTo(c[0]*t.canvas.width,c[1]*t.canvas.height),t.context.stroke())})},e.prototype.drawSkeleton=function(e,t){var n=this;this.drawSkeletonLines(e),e.forEach(function(e,t){0!==e[2]&&(n.context.beginPath(),n.context.fillStyle="#ffffff",n.context.arc(e[0]*n.canvas.width,e[1]*n.canvas.height,n.markerSize,0,2*Math.PI),n.context.fill())})},e}();t.Visualization=r}])});
//# sourceMappingURL=analysis.js.map