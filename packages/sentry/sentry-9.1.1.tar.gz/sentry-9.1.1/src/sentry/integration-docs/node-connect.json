{
  "html": "<p>Our Connect integration only requires the installation of <em>@sentry/node</em>, and then you can use it like this:</p>\n\n<pre class=\"highlight\"><code><span class=\"kd\">const</span> <span class=\"nx\">connect</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">'connect'</span><span class=\"p\">);</span>\n<span class=\"kd\">const</span> <span class=\"nx\">Sentry</span> <span class=\"o\">=</span> <span class=\"nx\">require</span><span class=\"p\">(</span><span class=\"s1\">'@sentry/node'</span><span class=\"p\">);</span>\n\n<span class=\"c1\">// Must configure Sentry before doing anything else with it</span>\n<span class=\"nx\">Sentry</span><span class=\"p\">.</span><span class=\"nx\">init</span><span class=\"p\">({</span> <span class=\"na\">dsn</span><span class=\"p\">:</span> <span class=\"s1\">'___PUBLIC_DSN___'</span> <span class=\"p\">});</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">mainHandler</span><span class=\"p\">(</span><span class=\"nx\">req</span><span class=\"p\">,</span> <span class=\"nx\">res</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"k\">throw</span> <span class=\"k\">new</span> <span class=\"nb\">Error</span><span class=\"p\">(</span><span class=\"s1\">'Broke!'</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"kd\">function</span> <span class=\"nx\">onError</span><span class=\"p\">(</span><span class=\"nx\">err</span><span class=\"p\">,</span> <span class=\"nx\">req</span><span class=\"p\">,</span> <span class=\"nx\">res</span><span class=\"p\">,</span> <span class=\"nx\">next</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n  <span class=\"c1\">// The error id is attached to `res.sentry` to be returned</span>\n  <span class=\"c1\">// and optionally displayed to the user for support.</span>\n  <span class=\"nx\">res</span><span class=\"p\">.</span><span class=\"nx\">statusCode</span> <span class=\"o\">=</span> <span class=\"mi\">500</span><span class=\"p\">;</span>\n  <span class=\"nx\">res</span><span class=\"p\">.</span><span class=\"nx\">end</span><span class=\"p\">(</span><span class=\"nx\">res</span><span class=\"p\">.</span><span class=\"nx\">sentry</span> <span class=\"o\">+</span> <span class=\"s1\">'</span><span class=\"err\">\\</span><span class=\"s1\">n'</span><span class=\"p\">);</span>\n<span class=\"p\">}</span>\n\n<span class=\"nx\">connect</span><span class=\"p\">(</span>\n  <span class=\"c1\">// The request handler be the first item</span>\n  <span class=\"nx\">Sentry</span><span class=\"p\">.</span><span class=\"nx\">Handlers</span><span class=\"p\">.</span><span class=\"nx\">requestHandler</span><span class=\"p\">(),</span>\n\n  <span class=\"nx\">connect</span><span class=\"p\">.</span><span class=\"nx\">bodyParser</span><span class=\"p\">(),</span>\n  <span class=\"nx\">connect</span><span class=\"p\">.</span><span class=\"nx\">cookieParser</span><span class=\"p\">(),</span>\n  <span class=\"nx\">mainHandler</span><span class=\"p\">,</span>\n\n  <span class=\"c1\">// The error handler must be before any other error middleware</span>\n  <span class=\"nx\">Sentry</span><span class=\"p\">.</span><span class=\"nx\">Handlers</span><span class=\"p\">.</span><span class=\"nx\">errorHandler</span><span class=\"p\">(),</span>\n\n  <span class=\"c1\">// Optional fallthrough error handler</span>\n  <span class=\"nx\">onError</span>\n<span class=\"p\">).</span><span class=\"nx\">listen</span><span class=\"p\">(</span><span class=\"mi\">3000</span><span class=\"p\">);</span>\n</code></pre>", 
  "link": "https://docs.sentry.io/platforms/node/connect/", 
  "id": "node-connect", 
  "name": "Connect"
}
