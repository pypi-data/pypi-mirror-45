{%- macro curlies(item) -%}
{{ "{" }}{{ item }}{{ "}" }}
{%- endmacro -%}

{%- macro href(url, text) -%}
\href{{ "{" }}{{ url|replace("#", "\\#")|replace("%", "\\%")|replace("_", "\\_") }}{{ "}" }}{{ curlies(text) }}
{%- endmacro -%}

% generated from JIRA project {{ metadata.project }}
% using template at {{ metadata.template }}.
% Collecting ATM data from folder: "{{ metadata.folder }}"
% using dosteady version {{ metadata.docsteady_version }}
% Please do not edit -- update information in Jira instead

\section{Traceability}
\scriptsize{
\begin{longtable}[]{rp{6cm}p{2cm}p{2cm}p{1.5cm}p{1.5cm}p{1.5cm}}
\toprule
& Verification Elements & VE Status & VE Assignee &Test Cases & TC Status & TC Owner \tabularnewline
\midrule
\endhead

{% for requirement in requirements_map.values() -%}
    {{ loop.index }} &
    {{ href(requirement.jira_url, requirement.key + " - " + requirement.summary) }}
    {% set testcases_list = requirements_to_testcases[requirement.key] -%}
    & {{ ves[requirement.key]['status'] }} & {{ ves[requirement.key]['assignee'] }}
    {% set ntc = testcases_list|length %}
    {% for tc in testcases_list -%}
        {% if loop.index > 1 %}
            &&&
        {% endif %}
        & 
        \hyperref[{{ tc.lower() }}]{{ curlies(tc) }} 
        & {{ testcases_map[ tc ].status }} & {{ testcases_map[ tc ].owner }}
        \\
        {% if loop.index == ntc  %}
            \hdashline
        {% endif %}
    {% endfor -%}
    
{% endfor %}
\tabularnewline
\bottomrule
\end{longtable}
} % end scriptsize
