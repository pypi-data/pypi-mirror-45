{"version":3,"sources":["js/d3-context-menu.js"],"names":["root","factory","module","exports","d3","require","define","amd","e","contextMenu","this","utils","noop","isFn","value","const","toFactory","fallback","undefined","d3ContextMenu","closeMenu","select","remove","on","boundCloseCallback","menuItems","config","openCallback","onOpen","closeCallback","onClose","positionFactory","position","themeFactory","theme","data","index","element","bind","selectAll","enter","append","attr","event","preventDefault","stopPropagation","d","ret","divider","disabled","action","html","title","console","error","i","style","left","pageX","top","pageY"],"mappings":"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","sourcesContent":["(function(root, factory) {\n\tif (typeof module === 'object' && module.exports) {\n\t\tvar d3 = require('d3');\n\t\tmodule.exports = factory(d3);\n\t} else if(typeof define === 'function' && define.amd) {\n\t\ttry {\n\t\t\tvar d3 = require('d3');\n\t\t} catch (e) {\n\t\t\td3 = root.d3;\n\t\t}\n\n\t\td3.contextMenu = factory(d3);\n\t\tdefine([], function() {\n\t\t\treturn d3.contextMenu;\n\t\t});\n\t} else if(root.d3) {\n\t\troot.d3.contextMenu = factory(root.d3);\n\t}\n}(this,\n\tfunction (d3) {\n\t\tvar utils = {\n\t\t\tnoop: function () {},\n\t\t\t\n\t\t\t/**\n\t\t\t * @param {*} value\n\t\t\t * @returns {Boolean}\n\t\t\t */\n\t\t\tisFn: function (value) {\n\t\t\t\treturn typeof value === 'function';\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * @param {*} value\n\t\t\t * @returns {Function}\n\t\t\t */\n\t\t\tconst: function (value) {\n\t\t\t\treturn function () { return value; };\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * @param {Function|*} value\n\t\t\t * @param {*} [fallback]\n\t\t\t * @returns {Function}\n\t\t\t */\n\t\t\ttoFactory: function (value, fallback) {\n\t\t\t\tvalue = (value === undefined) ? fallback : value;\n\t\t\t\treturn utils.isFn(value) ? value : utils.const(value);\n\t\t\t}\n\t\t};\n\n\t\t// global state for d3-context-menu\n\t\tvar d3ContextMenu = null;\n\n\t\tvar closeMenu = function () {\n\t\t\t// global state is populated if a menu is currently opened\n\t\t\tif (d3ContextMenu) {\n\t\t\t\td3.select('.d3-context-menu').remove();\n\t\t\t\td3.select('body').on('mousedown.d3-context-menu', null);\n\t\t\t\td3ContextMenu.boundCloseCallback();\n\t\t\t\td3ContextMenu = null;\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Calls API method (e.g. `close`) or\n\t\t * returns handler function for the `contextmenu` event\n\t\t * @param {Function|Array|String} menuItems\n\t\t * @param {Function|Object} config\n\t\t * @returns {?Function}\n\t\t */\n\t\treturn function (menuItems, config) {\n\t\t\t// allow for `d3.contextMenu('close');` calls\n\t\t\t// to programatically close the menu\n\t\t\tif (menuItems === 'close') {\n\t\t\t\treturn closeMenu();\n\t\t\t}\n\n\t\t\t// for convenience, make `menuItems` a factory\n\t\t\t// and `config` an object\n\t\t\tmenuItems = utils.toFactory(menuItems);\n\n\t\t\tif (utils.isFn(config)) {\n\t\t\t\tconfig = { onOpen: config };\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconfig = config || {};\n\t\t\t}\n\n\t\t\t// resolve config\n\t\t\tvar openCallback = config.onOpen || utils.noop;\n\t\t\tvar closeCallback = config.onClose || utils.noop;\n\t\t\tvar positionFactory = utils.toFactory(config.position);\n\t\t\tvar themeFactory = utils.toFactory(config.theme, 'd3-context-menu-theme');\n\n\t\t\t/**\n\t\t\t * Context menu event handler\n\t\t\t * @param {*} data\n\t\t\t * @param {Number} index\n\t\t\t */\n\t\t\treturn function (data, index) {\n\t\t\t\tvar element = this;\n\n\t\t\t\t// close any menu that's already opened\n\t\t\t\tcloseMenu();\n\n\t\t\t\t// store close callback already bound to the correct args and scope\n\t\t\t\td3ContextMenu = {\n\t\t\t\t\tboundCloseCallback: closeCallback.bind(element, data, index)\n\t\t\t\t};\n\n\t\t\t\t// create the div element that will hold the context menu\n\t\t\t\td3.selectAll('.d3-context-menu').data([1])\n\t\t\t\t\t.enter()\n\t\t\t\t\t.append('div')\n\t\t\t\t\t.attr('class', 'd3-context-menu ' + themeFactory.bind(element)(data, index));\n\n\t\t\t\t// close menu on mousedown outside\n\t\t\t\td3.select('body').on('mousedown.d3-context-menu', closeMenu);\n\n\t\t\t\tvar list = d3.selectAll('.d3-context-menu')\n\t\t\t\t\t.on('contextmenu', function() {\n\t\t\t\t\t\tcloseMenu();\n\t\t\t\t\t\td3.event.preventDefault();\n\t\t\t\t\t\td3.event.stopPropagation();\n\t\t\t\t\t})\n\t\t\t\t\t.append('ul');\n\t\t\t\t\n\t\t\t\tlist.selectAll('li').data(menuItems.bind(element)(data, index)).enter()\n\t\t\t\t\t.append('li')\n\t\t\t\t\t.attr('class', function(d) {\n\t\t\t\t\t\tvar ret = '';\n\t\t\t\t\t\tif (utils.toFactory(d.divider).bind(element)(data, index)) {\n\t\t\t\t\t\t\tret += ' is-divider';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (utils.toFactory(d.disabled).bind(element)(data, index)) {\n\t\t\t\t\t\t\tret += ' is-disabled';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!d.action) {\n\t\t\t\t\t\t\tret += ' is-header';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t})\n\t\t\t\t\t.html(function(d) {\n\t\t\t\t\t\tif (utils.toFactory(d.divider).bind(element)(data, index)) {\n\t\t\t\t\t\t\treturn '<hr>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!d.title) {\n\t\t\t\t\t\t\tconsole.error('No title attribute set. Check the spelling of your options.');\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn utils.toFactory(d.title).bind(element)(data, index);\n\t\t\t\t\t})\n\t\t\t\t\t.on('click', function(d, i) {\n\t\t\t\t\t\tif (utils.toFactory(d.disabled).bind(element)(data, index)) return; // do nothing if disabled\n\t\t\t\t\t\tif (!d.action) return; // headers have no \"action\"\n\t\t\t\t\t\td.action.bind(element)(data, index);\n\t\t\t\t\t\tcloseMenu();\n\t\t\t\t\t});\n\n\t\t\t\t// the openCallback allows an action to fire before the menu is displayed\n\t\t\t\t// an example usage would be closing a tooltip\n\t\t\t\tif (openCallback.bind(element)(data, index) === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// get position\n\t\t\t\tvar position = positionFactory.bind(element)(data, index);\n\n\t\t\t\t// display context menu\n\t\t\t\td3.select('.d3-context-menu')\n\t\t\t\t\t.style('left', (position ? position.left : d3.event.pageX - 2) + 'px')\n\t\t\t\t\t.style('top', (position ? position.top : d3.event.pageY - 2) + 'px')\n\t\t\t\t\t.style('display', 'block');\n\n\t\t\t\td3.event.preventDefault();\n\t\t\t\td3.event.stopPropagation();\n\t\t\t};\n\t\t};\n\t}\n));\n"]}