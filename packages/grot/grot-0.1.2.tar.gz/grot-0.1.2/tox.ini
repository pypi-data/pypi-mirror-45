[tox]
envlist = translate_readme,check,py27,py34,py35,py36,py37,pypy,coverage
skip_missing_interpreters = true

[testenv]
usedevelop = true
setenv =
    COVERAGE_FILE={toxinidir}/.coverage/.cov_{envname}

deps =
    pdbpp==0.9.7
    pytest==4.3.0
    pytest-cov==2.6.1
    pytest-mock==1.10.1

whitelist_externals =
    rm
    mkdir
commands =
    mkdir -p {toxinidir}/.coverage
    rm -vf {toxinidir}/.coverage/.cov_{envname}
    py.test --cov-report= --cov . {posargs}


[testenv:check]
deps =
    docutils
    check-manifest
    flake8==3.7.7
    flake8-commas==2.0.0
    readme-renderer
    twine

commands =
    flake8 grot setup.py
    check-manifest
    python setup.py sdist
    twine check dist/*


[testenv:translate_readme]
# It's because gitlab and me likes markdown, but pypa prefers RST and fails with markdown.
# So the first source of README is README.md and this job translates it into README.rst
skipsdist = true
whitelist_externals = pandoc
deps = pypandoc==1.4
commands = pandoc -f markdown_github -t rst -o README.rst README.md

[testenv:coverage]
usedevelop = true

whitelist_externals =
    bash
deps =
    pytest-cov==2.6.1
commands =
    bash -c 'coverage combine {toxinidir}/.coverage/.cov_*'
    coverage report -i -m
    coverage html -i


[flake8]
max-line-length = 120
ignore = W191, E101
# E101: indentation contains mixed spaces and tabs
# W191: indentation contains tabs


[coverage:run]
source =
    grot/*
omit =
    setup.py
    examples/*
    tests/*
    .tox/*
    .git/*
parallel = true

[pytest]
python_files = test_*.py example_*.py
python_functions = test_* example_*
